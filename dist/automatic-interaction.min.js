!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).AutomaticInteraction={})}(this,(function(t){"use strict";const e={SELECTION:"selection",ZOOM:"zoom",PAN:"pan",FILTER:"filter",SORT:"sort",BRUSH:"brush",HIGHLIGHT:"highlight",ANNOTATE:"annotate",ARRANGE:"arrange"},n={SVG_CONTAINER:"svg",SVG_GROUP:"g",SVG_TICK:"tick",TICK_DOMAIN:"domain",DEFAULT_ID:"svg_plot",SVG_MARK:["circle","ellipse","line","polygon","polyline","rect","path"]};function i(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function r(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}var a={value:()=>{}};function o(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw new Error("illegal type: "+t);i[t]=[]}return new s(i)}function s(t){this._=t}function l(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function u(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}function c(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=a,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}s.prototype=o.prototype={constructor:s,on:function(t,e){var n,i=this._,r=l(t+"",i),a=-1,o=r.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<o;)if(n=(t=r[a]).type)i[n]=c(i[n],t.name,e);else if(null==e)for(n in i)i[n]=c(i[n],t.name,null);return this}for(;++a<o;)if((n=(t=r[a]).type)&&(n=u(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new s(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=new Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(i=this._[t]).length;a<n;++a)i[a].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};var h="http://www.w3.org/1999/xhtml",f={svg:"http://www.w3.org/2000/svg",xhtml:h,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function g(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),f.hasOwnProperty(e)?{space:f[e],local:t}:t}function d(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===h&&e.documentElement.namespaceURI===h?e.createElement(t):e.createElementNS(n,t)}}function p(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function _(t){var e=g(t);return(e.local?p:d)(e)}function m(){}function y(t){return null==t?m:function(){return this.querySelector(t)}}function v(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function x(){return[]}function b(t){return null==t?x:function(){return this.querySelectorAll(t)}}function w(t){return function(){return this.matches(t)}}function k(t){return function(e){return e.matches(t)}}var A=Array.prototype.find;function C(){return this.firstElementChild}var E=Array.prototype.filter;function B(){return Array.from(this.children)}function M(t){return new Array(t.length)}function R(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function N(t){return function(){return t}}function T(t,e,n,i,r,a){for(var o,s=0,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],i[s]=o):n[s]=new R(t,a[s]);for(;s<l;++s)(o=e[s])&&(r[s]=o)}function S(t,e,n,i,r,a,o){var s,l,u,c=new Map,h=e.length,f=a.length,g=new Array(h);for(s=0;s<h;++s)(l=e[s])&&(g[s]=u=o.call(l,l.__data__,s,e)+"",c.has(u)?r[s]=l:c.set(u,l));for(s=0;s<f;++s)u=o.call(t,a[s],s,a)+"",(l=c.get(u))?(i[s]=l,l.__data__=a[s],c.delete(u)):n[s]=new R(t,a[s]);for(s=0;s<h;++s)(l=e[s])&&c.get(g[s])===l&&(r[s]=l)}function L(t){return t.__data__}function z(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function X(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function I(t){return function(){this.removeAttribute(t)}}function Y(t){return function(){this.removeAttributeNS(t.space,t.local)}}function H(t,e){return function(){this.setAttribute(t,e)}}function $(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function q(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function O(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function P(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function K(t){return function(){this.style.removeProperty(t)}}function V(t,e,n){return function(){this.style.setProperty(t,e,n)}}function D(t,e,n){return function(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function j(t,e){return t.style.getPropertyValue(e)||P(t).getComputedStyle(t,null).getPropertyValue(e)}function G(t){return function(){delete this[t]}}function F(t,e){return function(){this[t]=e}}function U(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function Z(t){return t.trim().split(/^|\s+/)}function Q(t){return t.classList||new W(t)}function W(t){this._node=t,this._names=Z(t.getAttribute("class")||"")}function J(t,e){for(var n=Q(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function tt(t,e){for(var n=Q(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function et(t){return function(){J(this,t)}}function nt(t){return function(){tt(this,t)}}function it(t,e){return function(){(e.apply(this,arguments)?J:tt)(this,t)}}function rt(){this.textContent=""}function at(t){return function(){this.textContent=t}}function ot(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function st(){this.innerHTML=""}function lt(t){return function(){this.innerHTML=t}}function ut(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function ct(){this.nextSibling&&this.parentNode.appendChild(this)}function ht(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ft(){return null}function gt(){var t=this.parentNode;t&&t.removeChild(this)}function dt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function pt(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function _t(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function mt(t){return function(){var e=this.__on;if(e){for(var n,i=0,r=-1,a=e.length;i<a;++i)n=e[i],t.type&&n.type!==t.type||n.name!==t.name?e[++r]=n:this.removeEventListener(n.type,n.listener,n.options);++r?e.length=r:delete this.__on}}}function yt(t,e,n){return function(){var i,r=this.__on,a=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(r)for(var o=0,s=r.length;o<s;++o)if((i=r[o]).type===t.type&&i.name===t.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),void(i.value=e);this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function vt(t,e,n){var i=P(t),r=i.CustomEvent;"function"==typeof r?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function xt(t,e){return function(){return vt(this,t,e)}}function bt(t,e){return function(){return vt(this,t,e.apply(this,arguments))}}R.prototype={constructor:R,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},W.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var wt=[null];function kt(t,e){this._groups=t,this._parents=e}function At(){return new kt([[document.documentElement]],wt)}function Ct(t){return"string"==typeof t?new kt([[document.querySelector(t)]],[document.documentElement]):new kt([[t]],wt)}function Et(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,[(i=i.matrixTransform(e.getScreenCTM().inverse())).x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}kt.prototype=At.prototype={constructor:kt,select:function(t){"function"!=typeof t&&(t=y(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o,s=e[r],l=s.length,u=i[r]=new Array(l),c=0;c<l;++c)(a=s[c])&&(o=t.call(a,a.__data__,c,s))&&("__data__"in a&&(o.__data__=a.__data__),u[c]=o);return new kt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return v(t.apply(this,arguments))}}(t):b(t);for(var e=this._groups,n=e.length,i=[],r=[],a=0;a<n;++a)for(var o,s=e[a],l=s.length,u=0;u<l;++u)(o=s[u])&&(i.push(t.call(o,o.__data__,u,s)),r.push(o));return new kt(i,r)},selectChild:function(t){return this.select(null==t?C:function(t){return function(){return A.call(this.children,t)}}("function"==typeof t?t:k(t)))},selectChildren:function(t){return this.selectAll(null==t?B:function(t){return function(){return E.call(this.children,t)}}("function"==typeof t?t:k(t)))},filter:function(t){"function"!=typeof t&&(t=w(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,l=i[r]=[],u=0;u<s;++u)(a=o[u])&&t.call(a,a.__data__,u,o)&&l.push(a);return new kt(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,L);var n=e?S:T,i=this._parents,r=this._groups;"function"!=typeof t&&(t=N(t));for(var a=r.length,o=new Array(a),s=new Array(a),l=new Array(a),u=0;u<a;++u){var c=i[u],h=r[u],f=h.length,g=z(t.call(c,c&&c.__data__,u,i)),d=g.length,p=s[u]=new Array(d),_=o[u]=new Array(d),m=l[u]=new Array(f);n(c,h,p,_,m,g,e);for(var y,v,x=0,b=0;x<d;++x)if(y=p[x]){for(x>=b&&(b=x+1);!(v=_[b])&&++b<d;);y._next=v||null}}return(o=new kt(o,i))._enter=s,o._exit=l,o},enter:function(){return new kt(this._enter||this._groups.map(M),this._parents)},exit:function(){return new kt(this._exit||this._groups.map(M),this._parents)},join:function(t,e,n){var i=this.enter(),r=this,a=this.exit();return"function"==typeof t?(i=t(i))&&(i=i.selection()):i=i.append(t+""),null!=e&&(r=e(r))&&(r=r.selection()),null==n?a.remove():n(a),i&&r?i.merge(r).order():r},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,a=i.length,o=Math.min(r,a),s=new Array(r),l=0;l<o;++l)for(var u,c=n[l],h=i[l],f=c.length,g=s[l]=new Array(f),d=0;d<f;++d)(u=c[d]||h[d])&&(g[d]=u);for(;l<r;++l)s[l]=n[l];return new kt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i,r=t[e],a=r.length-1,o=r[a];--a>=0;)(i=r[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=X);for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var o,s=n[a],l=s.length,u=r[a]=new Array(l),c=0;c<l;++c)(o=s[c])&&(u[c]=o);u.sort(e)}return new kt(r,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var o=i[r];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r,a=e[n],o=0,s=a.length;o<s;++o)(r=a[o])&&t.call(r,r.__data__,o,a);return this},attr:function(t,e){var n=g(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==e?n.local?Y:I:"function"==typeof e?n.local?O:q:n.local?$:H)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?K:"function"==typeof e?D:V)(t,e,null==n?"":n)):j(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?G:"function"==typeof e?U:F)(t,e)):this.node()[t]},classed:function(t,e){var n=Z(t+"");if(arguments.length<2){for(var i=Q(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each(("function"==typeof e?it:e?et:nt)(n,e))},text:function(t){return arguments.length?this.each(null==t?rt:("function"==typeof t?ot:at)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?st:("function"==typeof t?ut:lt)(t)):this.node().innerHTML},raise:function(){return this.each(ct)},lower:function(){return this.each(ht)},append:function(t){var e="function"==typeof t?t:_(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:_(t),i=null==e?ft:"function"==typeof e?e:y(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(gt)},clone:function(t){return this.select(t?pt:dt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var i,r,a=_t(t+""),o=a.length;if(!(arguments.length<2)){for(s=e?yt:mt,i=0;i<o;++i)this.each(s(a[i],e,n));return this}var s=this.node().__on;if(s)for(var l,u=0,c=s.length;u<c;++u)for(i=0,l=s[u];i<o;++i)if((r=a[i]).type===l.type&&r.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?bt:xt)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i,r=t[e],a=0,o=r.length;a<o;++a)(i=r[a])&&(yield i)}};const Bt={capture:!0,passive:!1};function Mt(t){t.preventDefault(),t.stopImmediatePropagation()}function Rt(t,e){var n=t.document.documentElement,i=Ct(t).on("dragstart.drag",null);e&&(i.on("click.drag",Mt,Bt),setTimeout((function(){i.on("click.drag",null)}),0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Nt(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Tt(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function St(){}var Lt=.7,zt=1/Lt,Xt="\\s*([+-]?\\d+)\\s*",It="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ht=/^#([0-9a-f]{3,8})$/,$t=new RegExp(`^rgb\\(${Xt},${Xt},${Xt}\\)$`),qt=new RegExp(`^rgb\\(${Yt},${Yt},${Yt}\\)$`),Ot=new RegExp(`^rgba\\(${Xt},${Xt},${Xt},${It}\\)$`),Pt=new RegExp(`^rgba\\(${Yt},${Yt},${Yt},${It}\\)$`),Kt=new RegExp(`^hsl\\(${It},${Yt},${Yt}\\)$`),Vt=new RegExp(`^hsla\\(${It},${Yt},${Yt},${It}\\)$`),Dt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function jt(){return this.rgb().formatHex()}function Gt(){return this.rgb().formatRgb()}function Ft(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Ht.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ut(e):3===n?new Jt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Zt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Zt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=$t.exec(t))?new Jt(e[1],e[2],e[3],1):(e=qt.exec(t))?new Jt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ot.exec(t))?Zt(e[1],e[2],e[3],e[4]):(e=Pt.exec(t))?Zt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Kt.exec(t))?ae(e[1],e[2]/100,e[3]/100,1):(e=Vt.exec(t))?ae(e[1],e[2]/100,e[3]/100,e[4]):Dt.hasOwnProperty(t)?Ut(Dt[t]):"transparent"===t?new Jt(NaN,NaN,NaN,0):null}function Ut(t){return new Jt(t>>16&255,t>>8&255,255&t,1)}function Zt(t,e,n,i){return i<=0&&(t=e=n=NaN),new Jt(t,e,n,i)}function Qt(t){return t instanceof St||(t=Ft(t)),t?new Jt((t=t.rgb()).r,t.g,t.b,t.opacity):new Jt}function Wt(t,e,n,i){return 1===arguments.length?Qt(t):new Jt(t,e,n,null==i?1:i)}function Jt(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function te(){return`#${re(this.r)}${re(this.g)}${re(this.b)}`}function ee(){const t=ne(this.opacity);return`${1===t?"rgb(":"rgba("}${ie(this.r)}, ${ie(this.g)}, ${ie(this.b)}${1===t?")":`, ${t})`}`}function ne(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function ie(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function re(t){return((t=ie(t))<16?"0":"")+t.toString(16)}function ae(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new se(t,e,n,i)}function oe(t){if(t instanceof se)return new se(t.h,t.s,t.l,t.opacity);if(t instanceof St||(t=Ft(t)),!t)return new se;if(t instanceof se)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(o=e===a?(n-i)/s+6*(n<i):n===a?(i-e)/s+2:(e-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new se(o,s,l,t.opacity)}function se(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function le(t){return(t=(t||0)%360)<0?t+360:t}function ue(t){return Math.max(0,Math.min(1,t||0))}function ce(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Nt(St,Ft,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:jt,formatHex:jt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return oe(this).formatHsl()},formatRgb:Gt,toString:Gt}),Nt(Jt,Wt,Tt(St,{brighter(t){return t=null==t?zt:Math.pow(zt,t),new Jt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Lt:Math.pow(Lt,t),new Jt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Jt(ie(this.r),ie(this.g),ie(this.b),ne(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:te,formatHex:te,formatHex8:function(){return`#${re(this.r)}${re(this.g)}${re(this.b)}${re(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ee,toString:ee})),Nt(se,(function(t,e,n,i){return 1===arguments.length?oe(t):new se(t,e,n,null==i?1:i)}),Tt(St,{brighter(t){return t=null==t?zt:Math.pow(zt,t),new se(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Lt:Math.pow(Lt,t),new se(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new Jt(ce(t>=240?t-240:t+120,r,i),ce(t,r,i),ce(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new se(le(this.h),ue(this.s),ue(this.l),ne(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ne(this.opacity);return`${1===t?"hsl(":"hsla("}${le(this.h)}, ${100*ue(this.s)}%, ${100*ue(this.l)}%${1===t?")":`, ${t})`}`}}));var he=t=>()=>t;function fe(t){return 1==(t=+t)?ge:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}(e,n,t):he(isNaN(e)?n:e)}}function ge(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):he(isNaN(t)?e:t)}var de=function t(e){var n=fe(e);function i(t,e){var i=n((t=Wt(t)).r,(e=Wt(e)).r),r=n(t.g,e.g),a=n(t.b,e.b),o=ge(t.opacity,e.opacity);return function(e){return t.r=i(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return i.gamma=t,i}(1);function pe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var _e=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,me=new RegExp(_e.source,"g");function ye(t,e){var n,i,r,a=_e.lastIndex=me.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=_e.exec(t))&&(i=me.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:pe(n,i)})),a=me.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}var ve,xe=180/Math.PI,be={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function we(t,e,n,i,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*xe,skewX:Math.atan(l)*xe,scaleX:o,scaleY:s}}function ke(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s=[],l=[];return a=t(a),o=t(o),function(t,i,r,a,o,s){if(t!==r||i!==a){var l=o.push("translate(",null,e,null,n);s.push({i:l-4,x:pe(t,r)},{i:l-2,x:pe(i,a)})}else(r||a)&&o.push("translate("+r+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(t,e,n,a){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),a.push({i:n.push(r(n)+"rotate(",null,i)-2,x:pe(t,e)})):e&&n.push(r(n)+"rotate("+e+i)}(a.rotate,o.rotate,s,l),function(t,e,n,a){t!==e?a.push({i:n.push(r(n)+"skewX(",null,i)-2,x:pe(t,e)}):e&&n.push(r(n)+"skewX("+e+i)}(a.skewX,o.skewX,s,l),function(t,e,n,i,a,o){if(t!==n||e!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:pe(t,n)},{i:s-2,x:pe(e,i)})}else 1===n&&1===i||a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(t){for(var e,n=-1,i=l.length;++n<i;)s[(e=l[n]).i]=e.x(t);return s.join("")}}}var Ae=ke((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?be:we(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),Ce=ke((function(t){return null==t?be:(ve||(ve=document.createElementNS("http://www.w3.org/2000/svg","g")),ve.setAttribute("transform",t),(t=ve.transform.baseVal.consolidate())?we((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):be)}),", ",")",")");function Ee(t){return((t=Math.exp(t))+1/t)/2}var Be,Me,Re=function t(e,n,i){function r(t,r){var a,o,s=t[0],l=t[1],u=t[2],c=r[0],h=r[1],f=r[2],g=c-s,d=h-l,p=g*g+d*d;if(p<1e-12)o=Math.log(f/u)/e,a=function(t){return[s+t*g,l+t*d,u*Math.exp(e*t*o)]};else{var _=Math.sqrt(p),m=(f*f-u*u+i*p)/(2*u*n*_),y=(f*f-u*u-i*p)/(2*f*n*_),v=Math.log(Math.sqrt(m*m+1)-m),x=Math.log(Math.sqrt(y*y+1)-y);o=(x-v)/e,a=function(t){var i,r=t*o,a=Ee(v),c=u/(n*_)*(a*(i=e*r+v,((i=Math.exp(2*i))-1)/(i+1))-function(t){return((t=Math.exp(t))-1/t)/2}(v));return[s+c*g,l+c*d,u*a/Ee(e*r+v)]}}return a.duration=1e3*o*e/Math.SQRT2,a}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4),Ne=0,Te=0,Se=0,Le=0,ze=0,Xe=0,Ie="object"==typeof performance&&performance.now?performance:Date,Ye="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function He(){return ze||(Ye($e),ze=Ie.now()+Xe)}function $e(){ze=0}function qe(){this._call=this._time=this._next=null}function Oe(t,e,n){var i=new qe;return i.restart(t,e,n),i}function Pe(){ze=(Le=Ie.now())+Xe,Ne=Te=0;try{!function(){He(),++Ne;for(var t,e=Be;e;)(t=ze-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Ne}()}finally{Ne=0,function(){var t,e,n=Be,i=1/0;for(;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Be=e);Me=t,Ve(i)}(),ze=0}}function Ke(){var t=Ie.now(),e=t-Le;e>1e3&&(Xe-=e,Le=t)}function Ve(t){Ne||(Te&&(Te=clearTimeout(Te)),t-ze>24?(t<1/0&&(Te=setTimeout(Pe,t-Ie.now()-Xe)),Se&&(Se=clearInterval(Se))):(Se||(Le=Ie.now(),Se=setInterval(Ke,1e3)),Ne=1,Ye(Pe)))}function De(t,e,n){var i=new qe;return e=null==e?0:+e,i.restart((n=>{i.stop(),t(n+e)}),e,n),i}qe.prototype=Oe.prototype={constructor:qe,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?He():+n)+(null==e?0:+e),this._next||Me===this||(Me?Me._next=this:Be=this,Me=this),this._call=t,this._time=n,Ve()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ve())}};var je=o("start","end","cancel","interrupt"),Ge=[];function Fe(t,e,n,i,r,a){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var i,r=t.__transition;function a(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}function o(a){var u,c,h,f;if(1!==n.state)return l();for(u in r)if((f=r[u]).name===n.name){if(3===f.state)return De(o);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[u]):+u<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[u])}if(De((function(){3===n.state&&(n.state=4,n.timer.restart(s,n.delay,n.time),s(a))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,i=new Array(h=n.tween.length),u=0,c=-1;u<h;++u)(f=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++c]=f);i.length=c+1}}function s(e){for(var r=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(t,r);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var i in n.state=6,n.timer.stop(),delete r[e],r)return;delete t.__transition}r[e]=n,n.timer=Oe(a,0,n.time)}(t,n,{name:e,index:i,group:r,on:je,tween:Ge,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function Ue(t,e){var n=Qe(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Ze(t,e){var n=Qe(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Qe(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function We(t,e){var n,i,r,a=t.__transition,o=!0;if(a){for(r in e=null==e?null:e+"",a)(n=a[r]).name===e?(i=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(i?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete a[r]):o=!1;o&&delete t.__transition}}function Je(t,e){var n,i;return function(){var r=Ze(this,t),a=r.tween;if(a!==n)for(var o=0,s=(i=n=a).length;o<s;++o)if(i[o].name===e){(i=i.slice()).splice(o,1);break}r.tween=i}}function tn(t,e,n){var i,r;if("function"!=typeof n)throw new Error;return function(){var a=Ze(this,t),o=a.tween;if(o!==i){r=(i=o).slice();for(var s={name:e,value:n},l=0,u=r.length;l<u;++l)if(r[l].name===e){r[l]=s;break}l===u&&r.push(s)}a.tween=r}}function en(t,e,n){var i=t._id;return t.each((function(){var t=Ze(this,i);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Qe(t,i).value[e]}}function nn(t,e){var n;return("number"==typeof e?pe:e instanceof Ft?de:(n=Ft(e))?(e=n,de):ye)(t,e)}function rn(t){return function(){this.removeAttribute(t)}}function an(t){return function(){this.removeAttributeNS(t.space,t.local)}}function on(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttribute(t);return o===a?null:o===i?r:r=e(i=o,n)}}function sn(t,e,n){var i,r,a=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===a?null:o===i?r:r=e(i=o,n)}}function ln(t,e,n){var i,r,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttribute(t))===(s=l+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,l));this.removeAttribute(t)}}function un(t,e,n){var i,r,a;return function(){var o,s,l=n(this);if(null!=l)return(o=this.getAttributeNS(t.space,t.local))===(s=l+"")?null:o===i&&s===r?a:(r=s,a=e(i=o,l));this.removeAttributeNS(t.space,t.local)}}function cn(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function hn(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function fn(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&hn(t,r)),n}return r._value=e,r}function gn(t,e){var n,i;function r(){var r=e.apply(this,arguments);return r!==i&&(n=(i=r)&&cn(t,r)),n}return r._value=e,r}function dn(t,e){return function(){Ue(this,t).delay=+e.apply(this,arguments)}}function pn(t,e){return e=+e,function(){Ue(this,t).delay=e}}function _n(t,e){return function(){Ze(this,t).duration=+e.apply(this,arguments)}}function mn(t,e){return e=+e,function(){Ze(this,t).duration=e}}function yn(t,e){if("function"!=typeof e)throw new Error;return function(){Ze(this,t).ease=e}}function vn(t,e,n){var i,r,a=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Ue:Ze;return function(){var o=a(this,t),s=o.on;s!==i&&(r=(i=s).copy()).on(e,n),o.on=r}}var xn=At.prototype.constructor;function bn(t){return function(){this.style.removeProperty(t)}}function wn(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function kn(t,e,n){var i,r;function a(){var a=e.apply(this,arguments);return a!==r&&(i=(r=a)&&wn(t,a,n)),i}return a._value=e,a}function An(t){return function(e){this.textContent=t.call(this,e)}}function Cn(t){var e,n;function i(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&An(i)),e}return i._value=t,i}var En=0;function Bn(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Mn(){return++En}var Rn=At.prototype;Bn.prototype={constructor:Bn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=y(t));for(var i=this._groups,r=i.length,a=new Array(r),o=0;o<r;++o)for(var s,l,u=i[o],c=u.length,h=a[o]=new Array(c),f=0;f<c;++f)(s=u[f])&&(l=t.call(s,s.__data__,f,u))&&("__data__"in s&&(l.__data__=s.__data__),h[f]=l,Fe(h[f],e,n,f,h,Qe(s,n)));return new Bn(a,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=b(t));for(var i=this._groups,r=i.length,a=[],o=[],s=0;s<r;++s)for(var l,u=i[s],c=u.length,h=0;h<c;++h)if(l=u[h]){for(var f,g=t.call(l,l.__data__,h,u),d=Qe(l,n),p=0,_=g.length;p<_;++p)(f=g[p])&&Fe(f,e,n,p,g,d);a.push(g),o.push(l)}return new Bn(a,o,e,n)},selectChild:Rn.selectChild,selectChildren:Rn.selectChildren,filter:function(t){"function"!=typeof t&&(t=w(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a,o=e[r],s=o.length,l=i[r]=[],u=0;u<s;++u)(a=o[u])&&t.call(a,a.__data__,u,o)&&l.push(a);return new Bn(i,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),o=new Array(i),s=0;s<a;++s)for(var l,u=e[s],c=n[s],h=u.length,f=o[s]=new Array(h),g=0;g<h;++g)(l=u[g]||c[g])&&(f[g]=l);for(;s<i;++s)o[s]=e[s];return new Bn(o,this._parents,this._name,this._id)},selection:function(){return new xn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Mn(),i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],l=s.length,u=0;u<l;++u)if(o=s[u]){var c=Qe(o,e);Fe(o,t,n,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Bn(i,this._parents,t,n)},call:Rn.call,nodes:Rn.nodes,node:Rn.node,size:Rn.size,empty:Rn.empty,each:Rn.each,on:function(t,e){var n=this._id;return arguments.length<2?Qe(this.node(),n).on.on(t):this.each(vn(n,t,e))},attr:function(t,e){var n=g(t),i="transform"===n?Ce:nn;return this.attrTween(t,"function"==typeof e?(n.local?un:ln)(n,i,en(this,"attr."+t,e)):null==e?(n.local?an:rn)(n):(n.local?sn:on)(n,i,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var i=g(t);return this.tween(n,(i.local?fn:gn)(i,e))},style:function(t,e,n){var i="transform"==(t+="")?Ae:nn;return null==e?this.styleTween(t,function(t,e){var n,i,r;return function(){var a=j(this,t),o=(this.style.removeProperty(t),j(this,t));return a===o?null:a===n&&o===i?r:r=e(n=a,i=o)}}(t,i)).on("end.style."+t,bn(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var i,r,a;return function(){var o=j(this,t),s=n(this),l=s+"";return null==s&&(this.style.removeProperty(t),l=s=j(this,t)),o===l?null:o===i&&l===r?a:(r=l,a=e(i=o,s))}}(t,i,en(this,"style."+t,e))).each(function(t,e){var n,i,r,a,o="style."+e,s="end."+o;return function(){var l=Ze(this,t),u=l.on,c=null==l.value[o]?a||(a=bn(e)):void 0;u===n&&r===c||(i=(n=u).copy()).on(s,r=c),l.on=i}}(this._id,t)):this.styleTween(t,function(t,e,n){var i,r,a=n+"";return function(){var o=j(this,t);return o===a?null:o===i?r:r=e(i=o,n)}}(t,i,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==e)return this.tween(i,null);if("function"!=typeof e)throw new Error;return this.tween(i,kn(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(en(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,Cn(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i,r=Qe(this.node(),n).tween,a=0,o=r.length;a<o;++a)if((i=r[a]).name===t)return i.value;return null}return this.each((null==e?Je:tn)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?dn:pn)(e,t)):Qe(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?_n:mn)(e,t)):Qe(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(yn(e,t)):Qe(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Ze(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,i=n._id,r=n.size();return new Promise((function(a,o){var s={value:o},l={value:function(){0==--r&&a()}};n.each((function(){var n=Ze(this,i),r=n.on;r!==t&&((e=(t=r).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),n.on=e})),0===r&&a()}))},[Symbol.iterator]:Rn[Symbol.iterator]};var Nn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Tn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Sn(t,e,n,i){this.message=t,this.expected=e,this.found=n,this.location=i,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Sn)}At.prototype.interrupt=function(t){return this.each((function(){We(this,t)}))},At.prototype.transition=function(t){var e,n;t instanceof Bn?(e=t._id,t=t._name):(e=Mn(),(n=Nn).time=He(),t=null==t?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var o,s=i[a],l=s.length,u=0;u<l;++u)(o=s[u])&&Fe(o,t,e,u,s,n||Tn(o,e));return new Bn(i,this._parents,t,e)},function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(Sn,Error),Sn.buildMessage=function(t,e){var n={literal:function(t){return'"'+r(t.text)+'"'},class:function(t){var e,n="";for(e=0;e<t.parts.length;e++)n+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function i(t){return t.charCodeAt(0).toString(16).toUpperCase()}function r(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+i(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+i(t)}))}return"Expected "+function(t){var e,i,r,a=new Array(t.length);for(e=0;e<t.length;e++)a[e]=(r=t[e],n[r.type](r));if(a.sort(),a.length>0){for(e=1,i=1;e<a.length;e++)a[e-1]!==a[e]&&(a[i]=a[e],i++);a.length=i}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(t)+" but "+function(t){return t?'"'+r(t)+'"':"end of input"}(e)+" found."};var Ln=function(t,e){e=void 0!==e?e:{};var n,i={},r={svg_path:Q},a=Q,o=function(t,e){return function(t,e){if(!e)return[t];for(var n=[t],i=0,r=e.length;i<r;i++)n[i+1]=e[i][1];return n}(t,e)},s=/^[Mm]/,l=G(["M","m"],!1,!1),u=/^[Zz]/,c=G(["Z","z"],!1,!1),h=/^[Ll]/,f=G(["L","l"],!1,!1),g=function(t,e){return wt(t,e)},d=/^[Hh]/,p=G(["H","h"],!1,!1),_=/^[Vv]/,m=G(["V","v"],!1,!1),y=/^[Cc]/,v=G(["C","c"],!1,!1),x=/^[Ss]/,b=G(["S","s"],!1,!1),w=/^[Qq]/,k=G(["Q","q"],!1,!1),A=/^[Tt]/,C=G(["T","t"],!1,!1),E=/^[Aa]/,B=G(["A","a"],!1,!1),M=/^[01]/,R=G(["0","1"],!1,!1),N=j(",",!1),T=function(t){return t.join("")},S=".",L=j(".",!1),z=/^[eE]/,X=G(["e","E"],!1,!1),I=/^[+\-]/,Y=G(["+","-"],!1,!1),H=/^[0-9]/,$=G([["0","9"]],!1,!1),q=/^[ \t\n\r]/,O=G([" ","\t","\n","\r"],!1,!1),P=0,K=[{line:1,column:1}],V=0,D=[];if("startRule"in e){if(!(e.startRule in r))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=r[e.startRule]}function j(t,e){return{type:"literal",text:t,ignoreCase:e}}function G(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function F(e){var n,i=K[e];if(i)return i;for(n=e-1;!K[n];)n--;for(i={line:(i=K[n]).line,column:i.column};n<e;)10===t.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return K[e]=i,i}function U(t,e){var n=F(t),i=F(e);return{start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:i.line,column:i.column}}}function Z(t){P<V||(P>V&&(V=P,D=[]),D.push(t))}function Q(){var t,e,n,r,a;for(t=P,e=[],n=_t();n!==i;)e.push(n),n=_t();if(e!==i)if(n=function(){var t,e,n,r,a,s;if(t=P,(e=W())!==i){for(n=[],r=P,a=[],s=_t();s!==i;)a.push(s),s=_t();for(a!==i&&(s=W())!==i?r=a=[a,s]:(P=r,r=i);r!==i;){for(n.push(r),r=P,a=[],s=_t();s!==i;)a.push(s),s=_t();a!==i&&(s=W())!==i?r=a=[a,s]:(P=r,r=i)}n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}(),n===i&&(n=null),n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(e=function(t){if(!t)return[];for(var e=[],n=0;n<t.length;n++)e=e.concat.apply(e,t[n]);var i=e[0];return i&&"m"==i.code&&(delete i.relative,i.code="M"),e}(n),t=e):(P=t,t=i)}else P=t,t=i;else P=t,t=i;return t}function W(){var e,n,r,a,u,c;if(e=P,n=function(){var e,n,r,a,o,u,c;e=P,s.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(l));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=ot())!==i?(o=P,(u=ct())===i&&(u=null),u!==i&&(c=tt())!==i?o=u=[u,c]:(P=o,o=i),o===i&&(o=null),o!==i?(f=o,g=wt(h=n,[a]),f&&(g=g.concat(wt("M"==h?"L":"l",f[1]))),e=n=g):(P=e,e=i)):(P=e,e=i)}else P=e,e=i;var h,f,g;return e}(),n!==i){for(r=[],a=P,u=[],c=_t();c!==i;)u.push(c),c=_t();for(u!==i&&(c=J())!==i?a=u=[u,c]:(P=a,a=i);a!==i;){for(r.push(a),a=P,u=[],c=_t();c!==i;)u.push(c),c=_t();u!==i&&(c=J())!==i?a=u=[u,c]:(P=a,a=i)}r!==i?e=n=o(n,r):(P=e,e=i)}else P=e,e=i;return e}function J(){var e;return(e=function(){var e;P,u.test(t.charAt(P))?(e=t.charAt(P),P++):(e=i,Z(c));e!==i&&(e=wt("Z"));return e}())===i&&(e=function(){var e,n,r,a;e=P,h.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(f));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=tt())!==i?e=n=g(n,a):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,d.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(p));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=et())!==i?e=n=wt(n,a.map((function(t){return{x:t}}))):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,_.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(m));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i&&(a=et())!==i?e=n=wt(n,a.map((function(t){return{y:t}}))):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,y.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(v));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=P,(e=nt())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=nt())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=nt())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}(),a!==i?e=n=g(n,a):(P=e,e=i)):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,x.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(b));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=P,(e=it())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=it())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=it())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}(),a!==i?e=n=g(n,a):(P=e,e=i)):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,w.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(k));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=P,(e=rt())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=rt())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=rt())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}(),a!==i?e=n=g(n,a):(P=e,e=i)):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,A.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(C));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=P,(e=ot())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}(),a!==i?e=n=g(n,a):(P=e,e=i)):(P=e,e=i)}else P=e,e=i;return e}())===i&&(e=function(){var e,n,r,a;e=P,E.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(B));if(n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?(a=function(){var t,e,n,r,a,s;if(t=P,(e=at())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=at())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=at())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}(),a!==i?e=n=g(n,a):(P=e,e=i)):(P=e,e=i)}else P=e,e=i;return e}()),e}function tt(){var t,e,n,r,a,s;if(t=P,(e=ot())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=ot())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}function et(){var t,e,n,r,a,s;if(t=P,(e=lt())!==i){for(n=[],r=P,(a=ct())===i&&(a=null),a!==i&&(s=lt())!==i?r=a=[a,s]:(P=r,r=i);r!==i;)n.push(r),r=P,(a=ct())===i&&(a=null),a!==i&&(s=lt())!==i?r=a=[a,s]:(P=r,r=i);n!==i?t=e=o(e,n):(P=t,t=i)}else P=t,t=i;return t}function nt(){var t,e,n,r,a,o,s,l,u;return t=P,(e=ot())!==i?((n=ct())===i&&(n=null),n!==i&&(r=ot())!==i?((a=ct())===i&&(a=null),a!==i&&(o=ot())!==i?(l=r,u=o,t=e={x1:(s=e).x,y1:s.y,x2:l.x,y2:l.y,x:u.x,y:u.y}):(P=t,t=i)):(P=t,t=i)):(P=t,t=i),t}function it(){var t,e,n,r,a,o;return t=P,(e=ot())!==i?((n=ct())===i&&(n=null),n!==i&&(r=ot())!==i?(o=r,t=e={x2:(a=e).x,y2:a.y,x:o.x,y:o.y}):(P=t,t=i)):(P=t,t=i),t}function rt(){var t,e,n,r,a,o;return t=P,(e=ot())!==i?((n=ct())===i&&(n=null),n!==i&&(r=ot())!==i?(o=r,t=e={x1:(a=e).x,y1:a.y,x:o.x,y:o.y}):(P=t,t=i)):(P=t,t=i),t}function at(){var t,e,n,r,a,o,s,l,u,c,h,f;return t=P,(e=st())!==i?((n=ct())===i&&(n=null),n!==i&&(r=st())!==i?((a=ct())===i&&(a=null),a!==i&&(o=lt())!==i&&ct()!==i&&(s=ut())!==i?((l=ct())===i&&(l=null),l!==i&&(u=ut())!==i?((c=ct())===i&&(c=null),c!==i&&(h=ot())!==i?t=e={rx:e,ry:r,xAxisRotation:o,largeArc:s,sweep:u,x:(f=h).x,y:f.y}:(P=t,t=i)):(P=t,t=i)):(P=t,t=i)):(P=t,t=i)):(P=t,t=i),t}function ot(){var t,e,n,r;return t=P,(e=lt())!==i?((n=ct())===i&&(n=null),n!==i&&(r=lt())!==i?t=e={x:e,y:r}:(P=t,t=i)):(P=t,t=i),t}function st(){var t;return P,(t=ft())===i&&(t=pt()),t!==i&&(t=1*t),t}function lt(){var t,e,n;return P,t=P,(e=dt())===i&&(e=null),e!==i&&(n=ft())!==i?t=e=[e,n]:(P=t,t=i),t===i&&(t=P,(e=dt())===i&&(e=null),e!==i&&(n=pt())!==i?t=e=[e,n]:(P=t,t=i)),t!==i&&(t=1*t.join("")),t}function ut(){var e;return P,M.test(t.charAt(P))?(e=t.charAt(P),P++):(e=i,Z(R)),e!==i&&(e="1"==e),e}function ct(){var t,e,n,r,a;if(t=P,e=[],(n=_t())!==i)for(;n!==i;)e.push(n),n=_t();else e=i;if(e!==i)if((n=ht())===i&&(n=null),n!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?t=e=[e,n,r]:(P=t,t=i)}else P=t,t=i;else P=t,t=i;if(t===i){if(t=P,e=P,(n=ht())!==i){for(r=[],a=_t();a!==i;)r.push(a),a=_t();r!==i?e=n=[n,r]:(P=e,e=i)}else P=e,e=i;e!==i&&(e=""),t=e}return t}function ht(){var e;return 44===t.charCodeAt(P)?(e=",",P++):(e=i,Z(N)),e}function ft(){var e,n,r;return P,e=P,n=function(){var e,n,r,a;P,e=P,(n=pt())===i&&(n=null);n!==i?(46===t.charCodeAt(P)?(r=S,P++):(r=i,Z(L)),r!==i&&(a=pt())!==i?e=n=[n,r,a]:(P=e,e=i)):(P=e,e=i);e===i&&(e=P,(n=pt())!==i?(46===t.charCodeAt(P)?(r=S,P++):(r=i,Z(L)),r!==i?e=n=[n,r]:(P=e,e=i)):(P=e,e=i));e!==i&&(e=T(e));return e}(),n!==i?((r=gt())===i&&(r=null),r!==i?e=n=[n,r]:(P=e,e=i)):(P=e,e=i),e===i&&(e=P,(n=pt())!==i&&(r=gt())!==i?e=n=[n,r]:(P=e,e=i)),e!==i&&(e=T(e)),e}function gt(){var e,n,r,a;return P,e=P,z.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z(X)),n!==i?((r=dt())===i&&(r=null),r!==i&&(a=pt())!==i?e=n=[n,r,a]:(P=e,e=i)):(P=e,e=i),e!==i&&(e=T(e)),e}function dt(){var e;return I.test(t.charAt(P))?(e=t.charAt(P),P++):(e=i,Z(Y)),e}function pt(){var e,n;if(P,e=[],H.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z($)),n!==i)for(;n!==i;)e.push(n),H.test(t.charAt(P))?(n=t.charAt(P),P++):(n=i,Z($));else e=i;return e!==i&&(e=e.join("")),e}function _t(){var e;return P,q.test(t.charAt(P))?(e=t.charAt(P),P++):(e=i,Z(O)),e!==i&&(e=""),e}var mt,yt,vt,xt={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var bt in xt)xt[bt.toUpperCase()]=xt[bt];function wt(t,e){e||(e=[{}]);for(var n=e.length;n--;){var i={code:t,command:xt[t]};for(var r in t==t.toLowerCase()&&(i.relative=!0),e[n])i[r]=e[n][r];e[n]=i}return e}if((n=a())!==i&&P===t.length)return n;throw n!==i&&P<t.length&&Z({type:"end"}),mt=D,yt=V<t.length?t.charAt(V):null,vt=V<t.length?U(V,V+1):U(V,V),new Sn(Sn.buildMessage(mt,yt),mt,yt,vt)};Ln.parseSVG=Ln,Ln.makeAbsolute=function(t){var e,n={x:0,y:0},i={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return t.forEach((function(t){for(var r in"moveto"===t.command&&(e=t),t.x0=n.x,t.y0=n.y,i)r in t&&(t[r]+=t.relative?t[i[r]]:0);"x"in t||(t.x=n.x),"y"in t||(t.y=n.y),t.relative=!1,t.code=t.code.toUpperCase(),"closepath"==t.command&&(t.x=e.x,t.y=e.y),n=t})),t};var zn=Ln;var Xn=t=>()=>t;function In(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function Yn(t,e,n){this.k=t,this.x=e,this.y=n}Yn.prototype={constructor:Yn,scale:function(t){return 1===t?this:new Yn(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new Yn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Hn=new Yn(1,0,0);function $n(t){t.stopImmediatePropagation()}function qn(t){t.preventDefault(),t.stopImmediatePropagation()}function On(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Pn(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Kn(){return this.__zoom||Hn}function Vn(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Dn(){return navigator.maxTouchPoints||"ontouchstart"in this}function jn(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],o=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),o>a?(a+o)/2:Math.min(0,a)||Math.max(0,o))}function Gn(){var t,e,n,i=On,r=Pn,a=jn,s=Vn,l=Dn,u=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],h=250,f=Re,g=o("start","zoom","end"),d=500,p=0,_=10;function m(t){t.property("__zoom",Kn).on("wheel.zoom",A,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",E).filter(l).on("touchstart.zoom",B).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new Yn(e,t.x,t.y)}function v(t,e,n){var i=e[0]-n[0]*t.k,r=e[1]-n[1]*t.k;return i===t.x&&r===t.y?t:new Yn(t.k,i,r)}function x(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function b(t,e,n,i){t.on("start.zoom",(function(){w(this,arguments).event(i).start()})).on("interrupt.zoom end.zoom",(function(){w(this,arguments).event(i).end()})).tween("zoom",(function(){var t=this,a=arguments,o=w(t,a).event(i),s=r.apply(t,a),l=null==n?x(s):"function"==typeof n?n.apply(t,a):n,u=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),c=t.__zoom,h="function"==typeof e?e.apply(t,a):e,g=f(c.invert(l).concat(u/c.k),h.invert(l).concat(u/h.k));return function(t){if(1===t)t=h;else{var e=g(t),n=u/e[2];t=new Yn(n,l[0]-e[0]*n,l[1]-e[1]*n)}o.zoom(null,t)}}))}function w(t,e,n){return!n&&t.__zooming||new k(t,e)}function k(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=r.apply(t,e),this.taps=0}function A(t,...e){if(i.apply(this,arguments)){var n=w(this,e).event(t),r=this.__zoom,o=Math.max(u[0],Math.min(u[1],r.k*Math.pow(2,s.apply(this,arguments)))),l=Et(t);if(n.wheel)n.mouse[0][0]===l[0]&&n.mouse[0][1]===l[1]||(n.mouse[1]=r.invert(n.mouse[0]=l)),clearTimeout(n.wheel);else{if(r.k===o)return;n.mouse=[l,r.invert(l)],We(this),n.start()}qn(t),n.wheel=setTimeout(h,150),n.zoom("mouse",a(v(y(r,o),n.mouse[0],n.mouse[1]),n.extent,c))}function h(){n.wheel=null,n.end()}}function C(t,...e){if(!n&&i.apply(this,arguments)){var r=t.currentTarget,o=w(this,e,!0).event(t),s=Ct(t.view).on("mousemove.zoom",f,!0).on("mouseup.zoom",g,!0),l=Et(t,r),u=t.clientX,h=t.clientY;o.mouse=[l,this.__zoom.invert(l)],We(this),o.start()}function f(t){if(!o.moved){var e=t.clientX-u,n=t.clientY-h;o.moved=e*e+n*n>p}o.event(t).zoom("mouse",a(v(o.that.__zoom,o.mouse[0]=Et(t,r),o.mouse[1]),o.extent,c))}function g(t){s.on("mousemove.zoom mouseup.zoom",null),Rt(t.view,o.moved),o.event(t).end()}}function E(t,...e){if(i.apply(this,arguments)){var n=this.__zoom,o=Et(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(o),l=n.k*(t.shiftKey?.5:2),u=a(v(y(n,l),o,s),r.apply(this,e),c);qn(t),h>0?Ct(this).transition().duration(h).call(b,u,o,t):Ct(this).call(m.transform,u,o,t)}}function B(n,...r){if(i.apply(this,arguments)){var a,o,s,l,u=n.touches,c=u.length,h=w(this,r,n.changedTouches.length===c).event(n);for($n(n),o=0;o<c;++o)l=[l=Et(s=u[o],this),this.__zoom.invert(l),s.identifier],h.touch0?h.touch1||h.touch0[2]===l[2]||(h.touch1=l,h.taps=0):(h.touch0=l,a=!0,h.taps=1+!!t);t&&(t=clearTimeout(t)),a&&(h.taps<2&&(e=l[0],t=setTimeout((function(){t=null}),d)),We(this),h.start())}}function M(t,...e){if(this.__zooming){var n,i,r,o,s=w(this,e).event(t),l=t.changedTouches,u=l.length;for(qn(t),n=0;n<u;++n)r=Et(i=l[n],this),s.touch0&&s.touch0[2]===i.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===i.identifier&&(s.touch1[0]=r);if(i=s.that.__zoom,s.touch1){var h=s.touch0[0],f=s.touch0[1],g=s.touch1[0],d=s.touch1[1],p=(p=g[0]-h[0])*p+(p=g[1]-h[1])*p,_=(_=d[0]-f[0])*_+(_=d[1]-f[1])*_;i=y(i,Math.sqrt(p/_)),r=[(h[0]+g[0])/2,(h[1]+g[1])/2],o=[(f[0]+d[0])/2,(f[1]+d[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],o=s.touch0[1]}s.zoom("touch",a(v(i,r,o),s.extent,c))}}function R(t,...i){if(this.__zooming){var r,a,o=w(this,i).event(t),s=t.changedTouches,l=s.length;for($n(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),d),r=0;r<l;++r)a=s[r],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;if(o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0)o.touch0[1]=this.__zoom.invert(o.touch0[0]);else if(o.end(),2===o.taps&&(a=Et(a,this),Math.hypot(e[0]-a[0],e[1]-a[1])<_)){var u=Ct(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return m.transform=function(t,e,n,i){var r=t.selection?t.selection():t;r.property("__zoom",Kn),t!==r?b(t,e,n,i):r.interrupt().each((function(){w(this,arguments).event(i).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},m.scaleBy=function(t,e,n,i){m.scaleTo(t,(function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n}),n,i)},m.scaleTo=function(t,e,n,i){m.transform(t,(function(){var t=r.apply(this,arguments),i=this.__zoom,o=null==n?x(t):"function"==typeof n?n.apply(this,arguments):n,s=i.invert(o),l="function"==typeof e?e.apply(this,arguments):e;return a(v(y(i,l),o,s),t,c)}),n,i)},m.translateBy=function(t,e,n,i){m.transform(t,(function(){return a(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),r.apply(this,arguments),c)}),null,i)},m.translateTo=function(t,e,n,i,o){m.transform(t,(function(){var t=r.apply(this,arguments),o=this.__zoom,s=null==i?x(t):"function"==typeof i?i.apply(this,arguments):i;return a(Hn.translate(s[0],s[1]).scale(o.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,c)}),i,o)},k.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=Ct(this.that).datum();g.call(t,this.that,new In(t,{sourceEvent:this.sourceEvent,target:m,type:t,transform:this.that.__zoom,dispatch:g}),e)}},m.wheelDelta=function(t){return arguments.length?(s="function"==typeof t?t:Xn(+t),m):s},m.filter=function(t){return arguments.length?(i="function"==typeof t?t:Xn(!!t),m):i},m.touchable=function(t){return arguments.length?(l="function"==typeof t?t:Xn(!!t),m):l},m.extent=function(t){return arguments.length?(r="function"==typeof t?t:Xn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):r},m.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],m):[u[0],u[1]]},m.translateExtent=function(t){return arguments.length?(c[0][0]=+t[0][0],c[1][0]=+t[1][0],c[0][1]=+t[0][1],c[1][1]=+t[1][1],m):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},m.constrain=function(t){return arguments.length?(a=t,m):a},m.duration=function(t){return arguments.length?(h=+t,m):h},m.interpolate=function(t){return arguments.length?(f=t,m):f},m.on=function(){var t=g.on.apply(g,arguments);return t===g?m:t},m.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,m):Math.sqrt(p)},m.tapDistance=function(t){return arguments.length?(_=+t,m):_},m}function Fn(t,e,n){var i=d3.select("#"+t.state().svg.id);t.state().x_axis.scale&&!t.state().x_axis.ordinal.length&&t.state().x_axis.axis.scale(t.state().x_axis.scale)(),t.state().y_axis.scale&&!t.state().y_axis.ordinal.length&&t.state().y_axis.axis.scale(t.state().y_axis.scale)(),i.append("defs").append("clipPath").attr("id","clip-"+t.state().svg.id).append("rect").attr("x",t.state().x_axis.range[0]).attr("y",t.state().y_axis.range[1]).attr("width",Math.abs(t.state().x_axis.range[1]-t.state().x_axis.range[0])).attr("height",Math.abs(t.state().y_axis.range[0]-t.state().y_axis.range[1]));const r=i.selectAll('[__mark__="true"]');if(t.state().x_axis.scale&&t.state().y_axis.scale)for(const e of r.nodes()){let n=e.parentElement;"_g_clip"!==n.id&&(n=document.createElementNS("http://www.w3.org/2000/svg","g"),n.id="_g_clip",n.setAttribute("clip-path","url(#clip-"+t.state().svg.id+")"),e.parentElement.appendChild(n)),n.appendChild(e)}if("_g_clip"!==r.node().parentElement.id){let t=document.createElementNS("http://www.w3.org/2000/svg","g");t.id="_g_clip",r.node().parentElement.appendChild(t),r.nodes().forEach((e=>t.appendChild(e)))}r.node().parentElement.setAttribute("clip-path","url(#clip-"+t.state().svg.id+")");var a=r.node()._global_transform[0]+t.state().svg.getBoundingClientRect().left,o=r.node()._global_transform[1]+t.state().svg.getBoundingClientRect().top,s=i.append("g").attr("id","x-axis-zoom-accessor"),l=i.append("g").attr("id","y-axis-zoom-accessor");let u=d3.zoomIdentity;const c=Gn(),h=Gn(),f=()=>d3.zoomTransform(s.node()),g=()=>d3.zoomTransform(l.node());s.call(c).attr("pointer-events","none"),l.call(h).attr("pointer-events","none");i.call(Gn().on("zoom",(function({sourceEvent:e,transform:n}){if("wheel"===e.type||"dblclick"===e.type){if("hidden"===t.state().svg.parentNode.style.visibility)return;let e=document.getElementById("pan_mode"),n=document.getElementById("brush_mode");document.getElementById("filter_mode");let i=document.getElementById("annotate_mode");e.style.opacity=1,n.style.opacity=.4,i.style.opacity=.4,t.state().interactions.pan.flag=!0,t.state().interactions.brush.flag=!1,t.state().interactions.annotate.flag=!1,t.state().svg.style.cursor="move"}e.preventDefault(),document.getElementById("modebar").style.visibility="hidden";var d=t.state().interactions.pan.flag,p=t.state().interactions.pan.flag;const _=n.k/u.k,m=(n.x-u.x)/f().k,y=(n.y-u.y)/g().k;if(!t.state().x_axis.axis&&!t.state().y_axis.axis){let a=e.clientX-r.node()._global_transform[0]-t.state().svg.getBoundingClientRect().left,o=e.clientY-r.node()._global_transform[1]-t.state().svg.getBoundingClientRect().top;return 1===_?(d&&s.call(c.translateBy,m,0),p&&l.call(h.translateBy,0,y)):(s.call(c.scaleBy,_,[a,o]),l.call(h.scaleBy,_,[a,o])),r.attr("transform","translate("+f().x+","+g().y+") scale("+f().k+","+g().k+")"),i.selectAll("text").attr("transform","translate("+f().x+","+g().y+") scale("+f().k+","+g().k+")"),void(u=n)}let v=e.clientX-a>t.state().x_axis.range[0],x=e.clientY-o<t.state().y_axis.range[0],b=e.clientX-r.node()._global_transform[0]-t.state().svg.getBoundingClientRect().left,w=e.clientY-r.node()._global_transform[1]-t.state().svg.getBoundingClientRect().top;1===_?!e.shiftKey&&d&&v&&s.call(c.translateBy,m,0):v&&s.call(c.scaleBy,_,[b,w]),t.state().x_axis.ordinal.length?t.state().x_axis.axis.applyTransform(f())():t.state().x_axis.axis.scale(f().rescaleX(t.state().x_axis.scale))();let k="path"===r.node().nodeName&&"ellipse"===r.node().type&&x,A="path"===r.node().nodeName&&"ellipse"!==r.node().type&&x&&!v,C=t.state().x_axis.scale.domain().length>2&&x&&!v,E=2==t.state().x_axis.scale.domain().length&&"path"!==r.node().nodeName&&x;1===_?!e.shiftKey&&p&&(E||k||A||C)&&l.call(h.translateBy,0,y):(E||k||A||C)&&l.call(h.scaleBy,_,[b,w]),t.state().y_axis.axis.scale(g().rescaleY(t.state().y_axis.scale))(),e.ctrlKey,e.shiftKey,e.altKey,"mousemove"===e.type&&d||e.type,r.attr("transform",(function(){let e=this.__transform.match(/(-?\d+\.?-?\d*)/g),n=(this.getBoundingClientRect().left-this._global_transform[0]-t.state().svg.getBoundingClientRect().left+this.getBoundingClientRect().right-this._global_transform[0]-t.state().svg.getBoundingClientRect().left)/2,i=(this.getBoundingClientRect().top-this._global_transform[1]-t.state().svg.getBoundingClientRect().top+this.getBoundingClientRect().bottom-this._global_transform[1]-t.state().svg.getBoundingClientRect().top)/2;this._t||(this._t=[n,i]);let r=0==+e[0]?0:+e[0]-+this._t[0],a=0==+e[1]?0:+e[1]-+this._t[1],o=f().applyX(+this._t[0])+r,s=g().applyY(+this._t[1])+a,l="path"===this.nodeName&&"ellipse"!==this.type,u=t.state().x_axis.scale.domain().length>2;return l||u?"translate("+f().x+","+g().y+") scale("+f().k+","+g().k+")":"translate("+(this.hasAttribute("cx")?o-this.getAttribute("cx"):o)+","+(this.hasAttribute("cy")?s-this.getAttribute("cy"):s)+")"})),r.attr("vector-effect","non-scaling-stroke"),i.selectAll(".hover").attr("display","none");let B=document.querySelectorAll(".tooltip");B.length&&B.forEach((t=>t.style.visibility="hidden")),t.updateBrush(),u=n})))}function Un(t,e,n){let i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("fill","gray"),i.setAttribute("opacity",.35),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",0),i.setAttribute("height",0),i.setAttribute("id","brush-rect"),i.style.stroke="#fff";let r=t.state().svg;r.appendChild(i);let a=!1,o=[!1,!1];function s(e){if(!t.state().interactions.brush.flag||t.state().interactions.brush.on_elem)return;if(e.clientX-r.getBoundingClientRect().left>=+i.getAttribute("x")&&e.clientX-r.getBoundingClientRect().left<=+i.getAttribute("x")+ +i.getAttribute("width")&&e.clientY-r.getBoundingClientRect().top>=+i.getAttribute("y")&&e.clientY-r.getBoundingClientRect().top<=+i.getAttribute("y")+ +i.getAttribute("height"))return;t.state().interactions.brush.active=!0;var n=t.state().svg_marks[0]._global_transform[0]+t.state().svg.getBoundingClientRect().left,s=t.state().svg_marks[0]._global_transform[1]+t.state().svg.getBoundingClientRect().top;let l=e.clientX-n>t.state().x_axis.range[0],u=e.clientY-s<t.state().y_axis.range[0],c=!l&&u,h=l&&!u||("line"===t.state().svg_marks[0].type||"polyline"===t.state().svg_marks[0].type||"polygon"===t.state().svg_marks[0].type)&&!c&&t.state().x_axis.ticks.length;o[0]||c?i.setAttribute("width",t.state().x_axis.global_range[1]-t.state().x_axis.global_range[0]):i.setAttribute("width",0),o[1]||h?i.setAttribute("height",t.state().y_axis.global_range[0]-t.state().y_axis.global_range[1]):i.setAttribute("height",0),e.preventDefault(),a=!0,o[0]||c?i.setAttribute("x",t.state().x_axis.global_range[0]):i.setAttribute("x",e.clientX-r.getBoundingClientRect().left),o[1]||h?i.setAttribute("y",t.state().y_axis.global_range[1]):i.setAttribute("y",e.clientY-r.getBoundingClientRect().top),e.ctrlKey,e.shiftKey,e.altKey}function l(e){var n=t.state().svg_marks[0]._global_transform[0]+t.state().svg.getBoundingClientRect().left,s=t.state().svg_marks[0]._global_transform[1]+t.state().svg.getBoundingClientRect().top;let l=e.clientX-n>t.state().x_axis.range[0],u=e.clientY-s<t.state().y_axis.range[0],c=!l&&u,h=l&&!u||("line"===t.state().svg_marks[0].type||"polyline"===t.state().svg_marks[0].type||"polygon"===t.state().svg_marks[0].type)&&!c&&t.state().x_axis.ticks.length;if(a){e.preventDefault();let n=e.clientX-i.getAttribute("x")-r.getBoundingClientRect().left,a=e.clientY-i.getAttribute("y")-r.getBoundingClientRect().top;o[0]||c?i.setAttribute("width",t.state().x_axis.global_range[1]-t.state().x_axis.global_range[0]):i.setAttribute("width",Math.abs(n)),o[1]||h?i.setAttribute("height",t.state().y_axis.global_range[0]-t.state().y_axis.global_range[1]):i.setAttribute("height",Math.abs(a));let s=!c&&n<0?n:0,l=!h&&a<0?a:0;i.setAttribute("transform","translate("+s+","+l+")"),t.filter(+i.getAttribute("x")+ +r.getBoundingClientRect().left+s,+i.getAttribute("y")+ +r.getBoundingClientRect().top+l,Math.abs(+i.getAttribute("width")),Math.abs(+i.getAttribute("height")),e.ctrlKey||e.metaKey||e.altKey||e.shiftKey)}}function u(e){t.state().interactions.brush.active&&(t.state().interactions.brush.active=!1,a=!1,0==+i.getAttribute("width")||0==+i.getAttribute("height")?(t.unfilter(),d3.selectAll(".brush_tooltip").remove()):(i.setAttribute("width",0),i.setAttribute("height",0)))}r.addEventListener("mousedown",s),r.addEventListener("mousemove",l),r.addEventListener("mouseup",u),e.addEventListener("change",(function(){this.checked||(t.unfilter(),i.setAttribute("width",0),i.setAttribute("height",0)),this.checked?r.addEventListener("mousedown",s):r.removeEventListener("mousedown",s),this.checked?r.addEventListener("mousemove",l):r.removeEventListener("mousemove",l),this.checked?r.addEventListener("mouseup",u):r.removeEventListener("mouseup",u)})),document.querySelectorAll("ul.brush a.axis").forEach((e=>e.addEventListener("click",(function(e){switch(e.target.innerHTML){case"2D":o[0]=o[1]=!1;break;case"X axis":o[0]=!1,o[1]=!0;break;case"Y axis":o[0]=!0,o[1]=!1}0!=+i.getAttribute("width")&&0!=+i.getAttribute("height")&&(o[0]?(i.setAttribute("x",t.state().x_axis.global_range[0]),i.setAttribute("width",t.state().x_axis.global_range[1]-t.state().x_axis.global_range[0])):o[1]&&(i.setAttribute("y",t.state().y_axis.global_range[1]),i.setAttribute("height",t.state().y_axis.global_range[0]-t.state().y_axis.global_range[1])),t.filter(+i.getAttribute("x")+ +r.getBoundingClientRect().left,+i.getAttribute("y")+ +r.getBoundingClientRect().top,i.getAttribute("width"),i.getAttribute("height")))})))),function(t,e,n){var i=0,r=0,a=0,o=0;function s(s){(s=s||window.event).preventDefault(),i=a-s.clientX,r=o-s.clientY,a=s.clientX,o=s.clientY,n[1]||t.setAttribute("y",t.getAttribute("y")-r),n[0]||t.setAttribute("x",t.getAttribute("x")-i),e.filter(+t.getAttribute("x")+ +e.state().svg.getBoundingClientRect().left,+t.getAttribute("y")+ +e.state().svg.getBoundingClientRect().top,t.getAttribute("width"),t.getAttribute("height"))}function l(){t.onmouseup=null,t.onmousemove=null}t.onmousedown=function(e){e=e||window.event,a=e.clientX,o=e.clientY,t.onmouseup=l,t.onmousemove=s}}(i,t,o)}function Zn(t,e=null){if(document.querySelector("#"+t))return;const n=document.createElement("div");n.id=t,n.setAttribute("class",e||"tooltip"),n.style="opacity:1; visibility:visible; position:absolute; background-color:white; z-index:999; border:solid; border-width:1px; border-radius:2px; padding:2px; font-size:14px; font-weight:500; pointer-events:none;",document.body.insertBefore(n,null)}function Qn(t,e,n,i,r=null,a=null){if(n.hasAttribute("__legend__"))return;if(!r&&d3.selectAll(".brush_tooltip").nodes().length)return;let o=n.getAttribute("transform"),s=1,l=0;if(o){let t=o.match(/(-?\d+\.?\d*)/g);l=+t[0],s=+t[2]}let u,c,h=t.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]+t.state().svg.getBoundingClientRect().left,f=e.clientX-h,g=t.state().x_axis.range[0],d=n.getTotalLength();Zn("tooltip"+(r||""),a);let p=document.querySelector("#tooltip"+(r||""));for(f<t.state().x_axis.range[0]||t.state().x_axis.range[1]<f?(d3.selectAll(".hover").attr("visibility","hidden"),p&&(p.style.visibility="hidden")):(d3.selectAll(".hover").attr("visibility","visible"),p&&(p.style.visibility="visible")),f=(f-l)/s;u=Math.floor((g+d)/2),c=n.getPointAtLength(u),u!==d&&u!==g||c.x===f;)if(c.x>f)d=u;else{if(!(c.x<f))break;g=u}let _=c.y+t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1],m=t.state().y_axis.scale.invert(_-t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]),y=t.state().x_axis.scale.invert(f);if(y="number"==typeof y?Math.round(y):function(t){var e=t.getFullYear(),n=(1+t.getMonth()).toString();n=n.length>1?n:"0"+n;var i=t.getDate().toString();return n+"/"+(i=i.length>1?i:"0"+i)+"/"+e}(y),n.hasAttribute("opacity")&&1!=+n.getAttribute("opacity"))return;let v="line"===n.type||"polyline"===n.type?window.getComputedStyle(n).stroke:window.getComputedStyle(n).fill;p.innerHTML=1===i?1===t.state().svg_marks.length?Math.round(m):"<div><span class='dot' style='background-color:"+v+";'></span><div style='display:inline;margin-right:20px;'>"+(n.__data__&&n.__data__.key?n.__data__.key:"")+"</div> <div style='display:inline;float:right;'>"+Math.round(m)+"</div></div>":1===t.state().svg_marks.length?Math.round(m):"<div><span class='dot' style='background-color:"+v+";'></span><div style='display:inline;margin-right:20px;'>"+(n.__data__&&n.__data__.key?n.__data__.key:"")+"</div> <div style='display:inline;float:right;'>"+Math.round(m)+"</div></div>"+p.innerHTML,d3.selectAll(".dot").style("height","10px").style("width","10px").style("border-radius","50%").style("display","inline-block"),p.style.color="line"===n.type?window.getComputedStyle(n).stroke:"black",p.style.left=e.pageX+7.5,p.style.top=e.pageY-e.clientY+_+t.state().svg.getBoundingClientRect().top-15;let x=t.state().svg.querySelector("#_circle"+(r||"")+i);x?(x.setAttribute("cx",f*s+l+t.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]),x.setAttribute("cy",_),x.setAttribute("display","")):(x=document.createElementNS("http://www.w3.org/2000/svg","circle"),x.setAttribute("r",6),x.setAttribute("fill","line"===n.type||"polyline"===n.type?window.getComputedStyle(n).stroke:window.getComputedStyle(n).fill),x.setAttribute("opacity",.75),x.setAttribute("stroke","black"),x.setAttribute("stroke-width","1px"),x.id="_circle"+(r||"")+i,x.setAttribute("class",a||"hover"),t.state().svg.append(x),x.setAttribute("cx",f*s+l+t.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]),x.setAttribute("cy",_));let b=t.state().svg.querySelector("#_hoverline"+(r||""));b?(b.setAttribute("x1",e.clientX-t.state().svg.getBoundingClientRect().left),b.setAttribute("x2",e.clientX-t.state().svg.getBoundingClientRect().left),b.setAttribute("display","")):(b=document.createElementNS("http://www.w3.org/2000/svg","line"),b.setAttribute("stroke","black"),b.setAttribute("stroke-width",1.5),b.setAttribute("opacity","0.5"),b.style["pointer-events"]="none",b.setAttribute("class",a||"hover"),b.setAttribute("y1",t.state().y_axis.range[0]+t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]),b.setAttribute("y2",t.state().y_axis.range[1]+t.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]),b.setAttribute("x1",e.clientX-t.state().svg.getBoundingClientRect().left),b.setAttribute("x2",e.clientX-t.state().svg.getBoundingClientRect().left),b.id="_hoverline"+(r||""),t.state().svg.append(b))}function Wn(t,e){!function(t,e){function n(){console.log("leave"),t.state().interactions.brush.on_elem=!1,document.querySelector("#tooltip").style.visibility="hidden"}function i(e){if(t.state().interactions.selection.active=!0,document.getElementById("filter_mode").style.opacity=1,document.getElementById("filter_mode").style.display="block",e.target.hasAttribute("__legend__")){e.target.active=!0;let n=t.state().legend.filter((t=>t.glyph.active)),i=d3.min(n.map((t=>(+t.glyph.getBoundingClientRect().bottom-+t.glyph.getBoundingClientRect().top)/1))),r=d3.max(n.map((t=>(+t.glyph.getBoundingClientRect().bottom-+t.glyph.getBoundingClientRect().top)/1)));console.log([i,r]);let a=window.getComputedStyle(e.target).fill,o=a;a="none","none"===a&&(e.target.getBoundingClientRect().bottom,e.target.getBoundingClientRect().top);for(const e of t.state().svg_marks){let t;if("none"===a){if(window.getComputedStyle(e).fill!==o)continue;let n=(+e.getBoundingClientRect().bottom-+e.getBoundingClientRect().top)/1;t=i>n||n>r}else t=window.getComputedStyle(e).fill!=a;t?e.setAttribute("opacity",.25):e.setAttribute("opacity",1)}return e.ctrlKey,e.shiftKey,void e.altKey}e.ctrlKey,e.metaKey,e.altKey,e.shiftKey}function r(e){t.state().interactions.brush.on_elem=!0,Zn("tooltip");let n=document.querySelector("#tooltip"),i="",r=e.target;if(r.__inferred__data__){for(const[t,e]of Object.entries(r.__inferred__data__))i+=String(t)+": "+String(e),i+="<br/>";n.innerHTML=i,n.style.visibility="visible",n.style.left=e.pageX+7,n.style.top=e.pageY}}function a(e){const n=t.state().svg_marks;var i=0;for(const r of n)++i,Qn(t,e,r,i);if(n.length>1){let t=document.getElementById("tooltip");if([...t.children].sort(((t,e)=>+t.children[2].innerHTML<+e.children[2].innerText?1:-1)).forEach((e=>t.appendChild(e))),"polyline"!==n[0].type)for(let e=0;e<t.children.length-1;++e)t.children[e].children[2].innerHTML=+t.children[e].children[2].innerHTML-+t.children[e+1].children[2].innerHTML}}for(const e of t.state().svg_marks)e.type&&"ellipse"!==e.type&&(t.state().x_axis.ticks.length||t.state().y_axis.ticks.length)?(t.state().svg.addEventListener("mousemove",a),e.addEventListener("mouseenter",(function(e){t.state().interactions.brush.on_elem=!0})),e.addEventListener("mouseleave",(function(e){t.state().interactions.brush.on_elem=!1}))):(e.addEventListener("mouseenter",r),e.addEventListener("mouseleave",n)),e.style.cursor="pointer",e.addEventListener("click",i);e.addEventListener("change",(function(){if(!this.checked){d3.select("#"+t.state().svg.id).selectAll(".hover").attr("display","none");let e=document.querySelectorAll(".tooltip");e.length&&e.forEach((t=>t.style.visibility="hidden"))}for(const e of t.state().svg_marks)e.type&&"ellipse"!==e.type&&(t.state().x_axis.ticks.length||t.state().y_axis.ticks.length)?this.checked?t.state().svg.addEventListener("mousemove",a):t.state().svg.removeEventListener("mousemove",a):(this.checked?e.addEventListener("mouseenter",r):e.removeEventListener("mouseenter",r),this.checked?e.addEventListener("mouseleave",n):e.removeEventListener("mouseleave",n))}))}(t,e)}function Jn(t){return t}Wn.applyBrush=function(t,e,n,i,r){d3.selectAll(".brush_tooltip").remove();let a={clientX:e,pageX:e,clientY:n,pageY:n},o={clientX:e+ +i,pageX:e+ +i,clientY:n+ +r,pageY:n+ +r},s=0;for(const e of t.state().svg_marks)++s,Qn(t,a,e,s,"brush1","brush_tooltip"),Qn(t,o,e,s,"brush2","brush_tooltip");if(t.state().svg_marks.length>1){let e=[document.getElementById("tooltipbrush1"),document.getElementById("tooltipbrush2")];console.log(e);for(const n of e)if([...n.children].sort(((t,e)=>+t.children[2].innerHTML<+e.children[2].innerText?1:-1)).forEach((t=>n.appendChild(t))),"polyline"!==t.state().svg_marks[0].type)for(let t=0;t<n.children.length-1;++t)n.children[t].children[2].innerHTML=+n.children[t].children[2].innerHTML-+n.children[t+1].children[2].innerHTML}},Wn.updateBrush=function(t){if(!document.getElementById("_hoverlinebrush1"))return;let e=document.getElementById("_hoverlinebrush1").getBoundingClientRect().left,n=document.getElementById("_hoverlinebrush1").getBoundingClientRect().top,i=document.getElementById("_hoverlinebrush2").getBoundingClientRect().left,r=document.getElementById("_hoverlinebrush2").getBoundingClientRect().top,a={clientX:e,pageX:e,clientY:n,pageY:n},o={clientX:i,pageX:i,clientY:r,pageY:r},s=0;for(const e of t.state().svg_marks)++s,Qn(t,a,e,s,"brush1","brush_tooltip"),Qn(t,o,e,s,"brush2","brush_tooltip");if(t.state().svg_marks.length>1){let t=[document.getElementById("tooltipbrush1"),document.getElementById("tooltipbrush2")];for(const e of t){[...e.children].sort(((t,e)=>+t.children[2].innerHTML<+e.children[2].innerText?1:-1)).forEach((t=>e.appendChild(t)));for(let t=0;t<e.children.length-1;++t)e.children[t].children[2].innerHTML=+e.children[t].children[2].innerHTML-+e.children[t+1].children[2].innerHTML}}};function ti(t,e){return"translate("+t+","+e+")"}function ei(t,e){return"translate("+e+","+t+")"}function ni(t){return e=>+t(e)}function ii(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function ri(t,e,n){var i=[],r=null,a=null,o=6,s=6,l=3,u="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===t||3===t?ti:ei,h=null,f=1===t||3===t?0:1,g=null,d=1===t||3===t?n.state().x_axis:n.state().y_axis,p=d.ticks;function _(){var o=null==r?e.ticks?e.ticks.apply(e,i):e.domain():r,s=null==a?e.tickFormat?e.tickFormat.apply(e,i):Jn:a,l=(e.bandwidth?ii:ni)(e.copy(),u);function _(t,e){const i=t.getBoundingClientRect().right-t.parentElement._global_transform[0]-n.state().svg.getBoundingClientRect().left;t._t||(t._t=[i,t.hasAttribute("transform")?+t.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:i]);let r=e.applyX(t._t[0]);return r<d.range[0]||r>d.range[1]?t.style.display="none":t.style.display="block",r-t._t[0]+t._t[1]}function m(e,n){let i=e.label,r=e.ticks;i.innerHTML=d.ordinal.length||i.innerHTML==s(n)?i.innerHTML:s(n);let a=i.hasAttribute("transform")?1===t||3===t?i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[1]:i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:0,o=i.hasAttribute("transform")?1===t||3===t?i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[1]:1===t||3===t?i._global_transform[0]:i._global_transform[1];if(h=null==h?+o-l(n):h,g)var u=c(_(i,g),+Math.abs(a)>.01?+a:0);else u=c(l(n)+(Math.abs(h)<5?h:0)+d.global_range[f]-i._global_transform[f],+Math.abs(a)>.01?+a:0);let p=i.hasAttribute("transform")&&i.getAttribute("transform").includes("rotate")?+i.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g).pop():null;i.setAttribute("transform",u+(p?" rotate("+p+")":""));for(const e of r){let r=e.hasAttribute("transform")?1===t||3===t?e.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[1]:e.getAttribute("transform").match(/(-?\d+\.?\d*e?-?\d*)/g)[0]:0;if(g)var m=c(_(i,g),+Math.abs(a)>.01?+a:0);else m=c(l(n)+d.global_range[f]-i._global_transform[f],+Math.abs(r)>.01?+r:0);e.setAttribute("transform",m)}}o=4===t||2===t?o.reverse():o;for(var y=0;y<o.length&&y<p.length;++y)m(p[y],d.ordinal.length?d.ordinal[y]:o[y]);for(;y<o.length;++y){let t={label:p[0].label.cloneNode(),ticks:p[0].ticks.map((t=>{let e=t.cloneNode();return e._global_transform=t._global_transform,e})),offset:null};t.label._global_transform=p[0].label._global_transform,m(t,o[y]),p[0].label.parentElement.appendChild(t.label),p[0].ticks.forEach(((e,n)=>e.parentElement.appendChild(t.ticks[n]))),p.push(t)}let v=p.length;for(let t=0;y<v;++y){let e=p.length-1-t;p[e].label.remove(),p[e].ticks.forEach((t=>t.remove())),p.pop()}}return _.applyTransform=function(t){return arguments.length?(g=t,_):_},_.scale=function(t){return arguments.length?(e=t,_):e},_.ticks=function(){return i=Array.from(arguments),_},_.tickArguments=function(t){return arguments.length?(i=null==t?[]:Array.from(t),_):i.slice()},_.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),_):r&&r.slice()},_.tickFormat=function(t){return arguments.length?(a=t,_):a},_.tickSize=function(t){return arguments.length?(o=s=+t,_):o},_.tickSizeInner=function(t){return arguments.length?(o=+t,_):o},_.tickSizeOuter=function(t){return arguments.length?(s=+t,_):s},_.tickPadding=function(t){return arguments.length?(l=+t,_):l},_.offset=function(t){return arguments.length?(u=+t,_):u},_}function ai(t,e){return ri(3,t,e)}function oi(t){si(t)}let si=function(t){document.addEventListener("mouseup",(function(e){if(!t.state().interactions.annotate.flag||"hidden"===t.state().svg.parentElement.style.visibility)return;let n=e.clientX-t.state().svg.getBoundingClientRect().left,i=e.clientY-t.state().svg.getBoundingClientRect().top;if(n<t.state().x_axis.range[0]||i<t.state().y_axis.range[1])return;let r=prompt("Annotation text:");if(!r)return;const a=[{note:{label:r},x:e.clientX-t.state().svg.getBoundingClientRect().left,y:e.clientY-t.state().svg.getBoundingClientRect().top,dy:20,dx:20,connector:{end:"dot"}}],o=d3.annotation().type(d3.annotationLabel).annotations(a);d3.select("#"+t.state().svg.id).append("g").attr("class","annotation-group").call(o),e.ctrlKey,e.shiftKey,e.altKey}))};function li(t){t.state().x_axis.ordinal.length&&function(t){var e;function n(t){(t=t||window.event).preventDefault(),t.clientX,t.clientY,t.clientX,t.clientY,e.setAttribute("transform","translate(0,"+(t.clientY-e.__y__)+")")}function i(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",i);let r,a,o,s=new Map,l=window.getComputedStyle(e).fill;for(const n of t.state().svg_marks){if(n.hasAttribute("__legend__"))continue;n===e&&(r=+n.getBoundingClientRect().left);let t=+n.getBoundingClientRect().left;s[t]?s[t].push(n):s[t]=[n]}s[r].sort((function(t,e){return+t.getBoundingClientRect().bottom>+e.getBoundingClientRect().bottom?-1:1}));for(let t=0;t<s[r].length;++t)if(s[r][t]===e){a=t;break}for(const[t,e]of Object.entries(s)){let t;for(const n of e)if(window.getComputedStyle(n).fill===l){t=n;break}t.setAttribute("y",+e[a-1].getAttribute("y")-+t.getAttribute("height")),t.setAttribute("transform","translate(0, 0)");for(let n=a;n<e.length;++n){if(e[n]===t)continue;let i=n===a?t:e[n-1];e[n].setAttribute("y",+i.getAttribute("y")-+e[n].getAttribute("height"))}}a=t.state().legend.length-a-1,t.state().legend[a];for(let e=0;e<t.state().legend.length;++e)if(window.getComputedStyle(t.state().legend[e].glyph).fill===l){o=e;break}for(let e=o;e<a;++e){let n=t.state().legend[o].label.parentElement,i=t.state().legend[e+1].label.parentElement;n.appendChild(t.state().legend[e+1].label),n.appendChild(t.state().legend[e+1].glyph),i.appendChild(t.state().legend[o].label),i.appendChild(t.state().legend[o].glyph)}}document.addEventListener("mousedown",(function(r){if("hidden"!==t.state().svg.parentElement.style.visibility){(r=r||window.event).clientX,r.clientY,e=null;for(const n of t.state().svg_marks){if(n.hasAttribute("__legend__"))continue;let t=n.getBoundingClientRect();if(r.clientX>=+t.left&&r.clientX<=+t.right&&r.clientY>=+t.top&&r.clientY<=+t.bottom){e=n;break}}e&&(document.addEventListener("mousemove",n),document.addEventListener("mouseup",i),e.__y__=r.clientY)}}))}(t)}function ui(){var t={has_domain:!1,svg:null,svg_marks:[],text_marks:[],axis_text_marks:[],x_axis:{domain:[null,null],ordinal:[],range:[null,null],global_range:[null,null],ticks:[],scale:null,axis:null},y_axis:{domain:[null,null],ordinal:[],range:[null,null],global_range:[null,null],ticks:[],scale:null,axis:null},legend:[],titles:{x:null,y:null},interactions:{selection:{control:null,active:!1},zoom:{control:null,axis_control:null},pan:{control:null,axis_control:null,flag:!1},brush:{control:null,axis_control:null,flag:!0,active:!1,on_elem:!1},filter:{control:null,active:!1},sort:{control:null},annotate:{flag:!1},arrange:{flag:!1}}},n=function(t,e){let n={};for(let i=0;i<t.ticks.length;++i){let r=t.ticks[i].getBoundingClientRect()[e];t.ticks[i].setAttribute("class",("left"===e?"x-axis":"y-axis")+" tick"),r in n?n[r].ticks.push(t.ticks[i]):n[r]={label:null,ticks:[t.ticks[i]]}}t.ticks=[];for(const[e,i]of Object.entries(n))i.offset=+e,t.ticks.push(i);t.ticks.sort(((t,e)=>+t.offset<+e.offset?-1:+t.offset>+e.offset?1:0))},a=function(t){for(const[e,n]of Object.entries(t.ticks)){let e=n.label.__data__||0==+n.label.__data__?n.label.__data__:isNaN(parseInt(n.label.innerHTML))?n.label.innerHTML:+n.label.innerHTML.replace(/,/g,"");"string"==typeof e?t.ordinal.push(e):(t.domain[0]=null===t.domain[0]?e:r([t.domain[0],e]),t.domain[1]=null===t.domain[1]?e:i([t.domain[1],e]))}};function o(){}return o.hydrate=function(){for(const[n,i]of Object.entries(t.interactions))switch(n){case e.SELECTION:Wn(o,i.control);break;case e.ZOOM:Fn(o,i.control,i.axis_control);break;case e.PAN:break;case e.BRUSH:t.svg.style.cursor="crosshair",Un(o,i.control,i.axis_control);break;case e.FILTER:i.control;break;case e.SORT:break;case e.ANNOTATE:oi(o);break;case e.ARRANGE:li(o)}let n=!1;t.svg.addEventListener("mousedown",(function(t){n=!0})),t.svg.addEventListener("mouseup",(function(t){n=!1})),t.svg.addEventListener("mousemove",(function(e){if(n||(document.getElementById("modebar").style.visibility="visible"),t.interactions.pan.flag){let n=t.svg_marks[0]._global_transform[0]+o.state().svg.getBoundingClientRect().left,i=t.svg_marks[0]._global_transform[1]+o.state().svg.getBoundingClientRect().top,r=e.clientX-n>t.x_axis.range[0],a=e.clientY-i<t.y_axis.range[0];t.svg.style.cursor=r&&!a?"ew-resize":!r&&a?"ns-resize":"move"}})),t.svg.addEventListener("mouseleave",(function(e){(e.clientX<=+t.svg.getBoundingClientRect().left||e.clientX>=+t.svg.getBoundingClientRect().right)&&(document.getElementById("modebar").style.visibility="hidden")}));let i=document.getElementById("pan_mode"),r=document.getElementById("brush_mode"),a=document.getElementById("filter_mode"),s=document.getElementById("annotate_mode");i.addEventListener("click",(function(e){"hidden"!==t.svg.parentNode.style.visibility&&(i.style.opacity=.4==+i.style.opacity?1:.4,r.style.opacity=.4,s.style.opacity=.4,t.interactions.pan.flag=!t.interactions.pan.flag,t.interactions.brush.flag=!1,t.interactions.annotate.flag=!1,t.svg.style.cursor="move")})),r.addEventListener("click",(function(e){"hidden"!==t.svg.parentNode.style.visibility&&(r.style.opacity=.4==+r.style.opacity?1:.4,i.style.opacity=.4,s.style.opacity=.4,t.interactions.annotate.flag=!1,t.interactions.pan.flag=!1,t.interactions.brush.flag=!t.interactions.brush.flag,t.svg.style.cursor="crosshair")})),a.addEventListener("click",(function(e){if("hidden"===t.svg.parentNode.style.visibility)return;let n;t.interactions.filter.active=!t.interactions.filter.active,t.interactions.brush.flag=!1,t.interactions.annotate.flag=!1;for(const e of t.svg_marks)e.hasAttribute("__legend__")||(e.style.visibility=t.interactions.filter.active?1==+e.getAttribute("opacity")?"visible":"hidden":"visible","visible"===e.style.visibility&&(n=e));console.log(n)})),s.addEventListener("click",(function(e){"hidden"!==t.svg.parentNode.style.visibility&&(s.style.opacity=.4==+s.style.opacity?1:.4,i.style.opacity=.4,r.style.opacity=.4,t.interactions.brush.flag=!1,t.interactions.pan.flag=!1,t.interactions.annotate.flag=!t.interactions.annotate.flag,t.svg.style.cursor="pointer")}))},o.infer_mark_attributes=function(){for(const n of t.svg_marks)if("path"!==n.nodeName||!t.x_axis.ticks.length&&!t.y_axis.ticks.length||"path"===n.nodeName&&"ellipse"===n.type){if(n.__data__){if("string"==typeof n.__data__||"number"==typeof n.__data__){var e=n.__data__;break}let t="datum"in n.__data__,i="properties"in n.__data__,r="data"in n.__data__;e=t?n.__data__.datum:i?n.__data__.properties:r?n.__data__.data:n.__data__}else{let i=(n.getBoundingClientRect().left+n.getBoundingClientRect().right)/2-o.state().x_axis.ticks[0].ticks[0].parentNode._global_transform[0]-o.state().svg.getBoundingClientRect().left,r=(n.getBoundingClientRect().top+n.getBoundingClientRect().bottom)/2-o.state().y_axis.ticks[0].ticks[0].parentNode._global_transform[1]-o.state().svg.getBoundingClientRect().top;e={[t.titles.x.innerHTML]:t.x_axis.scale.invert(i).toFixed(2),[t.titles.y.innerHTML]:t.y_axis.scale.invert(r).toFixed(2)}}n.style["pointer-events"]="fill",n.__inferred__data__=e}return o},o.state=function(){return t},o.updateBrush=function(){Wn.updateBrush(o)},o.disambiguate=function(t,e=!1){},o.filter=function(e,n,i,r,a=!1){document.getElementById("filter_mode").style.opacity=1,document.getElementById("filter_mode").style.display="block";for(const g of t.svg_marks)if("hidden"!==g.style.visibility&&!g.hasAttribute("__legend__")){if(("line"===g.type||"polygon"===g.type||"polyline"===g.type)&&t.x_axis.ticks.length&&t.y_axis.ticks.length)return t.interactions.brush.active=!0,void Wn.applyBrush(o,e,n,i,r);if(t.x_axis.ordinal.length||!t.x_axis.ticks.length&&!t.y_axis.ticks.length){var s=e,l=e+ +i,u=n+ +r,c=n;let t=g.getBoundingClientRect();var h=(+t.left+ +t.right)/2,f=(+t.top+ +t.bottom)/2}else{s=t.x_axis.scale.invert(e),l=t.x_axis.scale.invert(e+ +i),u=t.y_axis.scale.invert(n),c=t.y_axis.scale.invert(n+ +r);let a=g.getBoundingClientRect();h=(t.x_axis.scale.invert(+a.left)+t.x_axis.scale.invert(+a.right))/2,f=(t.y_axis.scale.invert(+a.top)+t.y_axis.scale.invert(+a.bottom))/2}h<s||h>l||f<c||f>u?a||g.setAttribute("opacity",.25):g.setAttribute("opacity",1)}},o.unfilter=function(){t.interactions.brush.active=!1;let e=!1;for(const n of t.svg_marks)"hidden"===n.style.visibility?e=!0:n.setAttribute("opacity",1);e||(document.getElementById("filter_mode").style.display="none")},o.analyze_axes=function(){return n(t.x_axis,"left"),n(t.y_axis,"top"),function(){for(let e=0;e<t.axis_text_marks.length;++e){let n=(+t.axis_text_marks[e].getBoundingClientRect().left+ +t.axis_text_marks[e].getBoundingClientRect().right)/2,i=(+t.axis_text_marks[e].getBoundingClientRect().top+ +t.axis_text_marks[e].getBoundingClientRect().bottom)/2,r=0,a=0;for(let e=0;e<t.x_axis.ticks.length;++e)Math.abs(n-t.x_axis.ticks[e].offset)<Math.abs(n-t.x_axis.ticks[r].offset)&&(r=e);for(let e=0;e<t.y_axis.ticks.length;++e)Math.abs(i-t.y_axis.ticks[e].offset)<Math.abs(i-t.y_axis.ticks[a].offset)&&(a=e);Math.abs(n-t.x_axis.ticks[r].offset)<Math.abs(i-t.y_axis.ticks[a].offset)?t.x_axis.ticks[r].label=t.axis_text_marks[e]:t.y_axis.ticks[a].label=t.axis_text_marks[e],t.axis_text_marks[e].setAttribute("class","tick")}}(),function(){if("hexchart"===t.svg.id)return;let e,n,i=1e4,r=0;for(const a of t.text_marks)a.getBoundingClientRect().left<i&&(i=a.getBoundingClientRect().left,n=a),a.getBoundingClientRect().bottom>r&&(r=a.getBoundingClientRect().bottom,e=a);n&&Math.abs(i-t.svg.getBoundingClientRect().left)<50&&(n.__title__=!0,t.titles.y=n),e&&Math.abs(r-t.svg.getBoundingClientRect().bottom)<50&&(e.__title__=!0,t.titles.x=e);for(const e of t.text_marks){if(e.__title__)continue;let n,i=(+e.getBoundingClientRect().left+ +e.getBoundingClientRect().right)/2,r=(+e.getBoundingClientRect().top+ +e.getBoundingClientRect().bottom)/2,a=1e4;console.log(e);for(const e of t.svg_marks){let t=(+e.getBoundingClientRect().left+ +e.getBoundingClientRect().right)/2,o=(+e.getBoundingClientRect().bottom+ +e.getBoundingClientRect().bottom)/2,s=Math.abs(t-i)+Math.abs(o-r);s<a&&(a=s,n=e)}n.removeAttribute("__mark__"),e.setAttribute("__legend__",!0),n.setAttribute("__legend__","true"),t.legend.push({label:e,glyph:n})}}(),o},o.infer_view=function(){a(t.x_axis),a(t.y_axis);const e=+t.svg.getAttribute("width"),n=+t.svg.getAttribute("height");if(!t.x_axis.ticks.length&&!t.y_axis.ticks.length)return t.x_axis.range=t.x_axis.global_range=[0,e],t.y_axis.range=t.y_axis.global_range=[n,0],o;if(t.has_domain){let e=[].slice.call(t.svg.querySelectorAll(".domain")).map((t=>t.getBoundingClientRect())),n=e[0].width<e[1].width?e[0]:e[1],a=e[0].height<e[1].height?e[0]:e[1];var i=a.left-t.svg.getBoundingClientRect().left,r=a.right-t.svg.getBoundingClientRect().left,s=n.bottom-t.svg.getBoundingClientRect().top,l=n.top-t.svg.getBoundingClientRect().top}else{let n=t.y_axis.ticks[0].ticks[0].getBoundingClientRect(),a=t.x_axis.ticks[0].ticks[0].getBoundingClientRect();if(n.right<a.left)i=n.right-t.svg.getBoundingClientRect().left,r=e;else i=n.left-t.svg.getBoundingClientRect().left,r=d3.min([n.width+i,e]);if(a.top>n.bottom)s=a.top-t.svg.getBoundingClientRect().top,l=0;else s=a.bottom-t.svg.getBoundingClientRect().top,l=d3.max([s-a.height,0])}t.x_axis.global_range=[i,r],t.y_axis.global_range=[s,l],t.x_axis.range=[i,r].map((e=>e-t.x_axis.ticks[0].ticks[0].parentNode._global_transform[0])),t.y_axis.range=[s,l].map((e=>e-t.y_axis.ticks[0].ticks[0].parentNode._global_transform[1]));let u=+t.y_axis.ticks[1].label.innerHTML-+t.y_axis.ticks[0].label.innerHTML,c=+t.y_axis.ticks[2].label.innerHTML-+t.y_axis.ticks[1].label.innerHTML,h=+t.x_axis.ticks[1].label.innerHTML-+t.x_axis.ticks[0].label.innerHTML;if(t.x_axis.ticks.length<3)var f=0;else f=+t.x_axis.ticks[2].label.innerHTML-+t.x_axis.ticks[1].label.innerHTML;let g=t.x_axis.ticks[1].ticks[0].getBoundingClientRect().left-t.x_axis.ticks[0].ticks[0].getBoundingClientRect().left;if(t.x_axis.ticks.length<3)var d=0;else d=t.x_axis.ticks[2].ticks[0].getBoundingClientRect().left-t.x_axis.ticks[1].ticks[0].getBoundingClientRect().left;if(Math.abs(h-f)>.5||Math.abs(g-d)>.5){if(Math.abs(g-d)<.5){let e=t.x_axis.ticks.ticks[0].childNodes[1].innerHTML;if(e!=t.x_axis.ticks[0].__data__&&"string"==typeof e){var p=e.match(/^(e|\d+)\^(e|\d+)$/),_=e.match(/^(e|d+)([\u2070-\u209F\u00B2\u00B3\u00B9])$/);if(p)m="e"===(m=p[1])?Math.E:parseInt(m);else if(_){var m;m="e"===(m=_[1])?Math.E:parseInt(m)}}}function e(t){let e=Math.log(t)/Math.log(m);return _?"e"+String(e).replace(/\d/g,(function(t){return""[t]})):t+"^"+e}t.x_axis.scale=d3.scaleLog().domain(t.x_axis.domain).range(t.x_axis.range),t.x_axis.axis=ai(t.x_axis.scale,o).ticks(t.x_axis.ticks.filter((t=>t.label.innerHTML)).length),m&&(t.x_axis.scale=t.x_axis.scale.base(m),t.x_axis.axis=t.x_axis.axis.tickFormat((t=>p||_?e(t):t)))}else t.x_axis.scale=(t.x_axis.domain[0]instanceof Date?d3.scaleTime():t.x_axis.ordinal.length?d3.scaleBand():d3.scaleLinear()).domain(t.x_axis.ordinal.length?t.x_axis.ordinal:t.x_axis.domain).range(t.x_axis.range),t.x_axis.axis=ai(t.x_axis.scale,o).ticks(t.x_axis.ticks.length);return Math.abs(u-c)>.5?(t.y_axis.scale=d3.scaleLog().domain(t.y_axis.domain).range(t.y_axis.range),t.y_axis.axis=d3.axisLeft(t.y_axis.scale).tickSize(-t.y_axis.ticks[1].children[0].getAttribute("x2")).ticks(t.y_axis.ticks.length)):(t.y_axis.scale=(t.y_axis.domain[0]instanceof Date?d3.scaleTime():t.y_axis.ordinal.length?d3.scaleBand():d3.scaleLinear()).domain(t.y_axis.ordinal.length?t.y_axis.ordinal:t.y_axis.domain).range(t.y_axis.range),t.y_axis.axis=function(t,e){return ri(4,t,e)}(t.y_axis.scale,o).ticks(t.y_axis.ticks.length).tickFormat((e=>{let n=t.y_axis.ticks[0].label.innerHTML;return n.includes("M")||n.includes("k")?d3.format(".2s")(e):d3.format(",")(e)}))),function(){if(o.state().x_axis.scale&&!o.state().x_axis.ordinal.length){let t=o.state().x_axis.ticks[0].ticks[0],e=o.state().x_axis.ticks[o.state().x_axis.ticks.length-1].ticks[0];t=+(t.hasAttribute("transform")?t.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[0]:t._global_transform[0]-o.state().x_axis.global_range[0]),e=+(e.hasAttribute("transform")?e.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[0]:e._global_transform[0]-o.state().x_axis.global_range[0]);let n=o.state().x_axis.range.map(o.state().x_axis.scale.copy().range([t,e]).invert,o.state().x_axis.scale);o.state().x_axis.scale.domain(n)}if(o.state().y_axis.scale&&!o.state().y_axis.ordinal.length){let t=o.state().y_axis.ticks[0].ticks[0],e=o.state().y_axis.ticks[o.state().y_axis.ticks.length-1].ticks[0];t=+(t.hasAttribute("transform")?t.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[1]:t._global_transform[1]-o.state().y_axis.global_range[1]),e=+(e.hasAttribute("transform")?e.getAttribute("transform").match(/(-?\d+\.?-?\d*)/g)[1]:e._global_transform[1]-o.state().y_axis.global_range[1]);let n=o.state().y_axis.range.map(o.state().y_axis.scale.copy().range([e,t]).invert,o.state().y_axis.scale);o.state().y_axis.scale.domain(n)}}(),o},o}function ci(t){let e=zn.parseSVG(t.getAttribute("d"));if(!e.length)return;t.contour=e;let n=e[e.length-1];3===e.length&&"A"===e[1].code&&"A"===n.code?t.type="ellipse":"Z"!==n.code?t.type="line":t.type="polygon"}function hi(t,e,i){if(t._global_transform=[...i],t.nodeName===n.SVG_GROUP){let e=t.getAttribute("transform");e&&(i[0]+=+e.match(/(\d+\.?\d*)/g)[0],i[1]+=+e.match(/(\d+\.?\d*)/g)[1])}else if("text"===t.nodeName)e.state().axis_text_marks.push(t),t.style["pointer-events"]="none",t.style["user-select"]="none";else for(const i of n.SVG_MARK)if(t.nodeName===i){let n=t.hasAttribute("x2")?+t.getAttribute("x2"):0;n=n||Math.abs(+t.getBoundingClientRect().bottom-+t.getBoundingClientRect().top)<1;let i=t.hasAttribute("y2")?+t.getAttribute("y2"):0;i=i||Math.abs(+t.getBoundingClientRect().left-+t.getBoundingClientRect().right)<1,n&&e.state().y_axis.ticks.push(t),i&&e.state().x_axis.ticks.push(t)}for(const n of t.childNodes)hi(n,e,[...i])}function fi(t,e,i){if(null!==t){var r=!1;if(t._global_transform=[...i],t.nodeName===n.SVG_CONTAINER&&(e.state().svg=t),t.nodeName===n.SVG_GROUP){let n=t.getAttribute("transform");n&&(i[0]+=+n.match(/(\d+\.?\d*)/g)[0],i[1]+=+n.match(/(\d+\.?\d*)/g)[1]);let a=t.className.animVal;if(a.includes("legend"));else if(a.includes("tick")||a.includes("grid")||a.includes("label")){r=!0;for(const n of t.childNodes)hi(n,e,[...i])}}else{let i=!1;for(const r of n.SVG_MARK){if("text"===t.nodeName&&(t.style["pointer-events"]="none",t.style["user-select"]="none",i||(e.state().text_marks.push(t),i=!0)),t.className&&("background"===t.className.animVal||"foreground"===t.className.animVal))break;if(t.nodeName===r){if("path"===r){if(!t.hasAttribute("d"))break;ci(t)}else"polyline"===r&&(t.type="polyline");t.className&&t.className.animVal===n.TICK_DOMAIN?e.state().has_domain=!0:(t.setAttribute("__mark__","true"),t.__transform=t.hasAttribute("transform")?t.getAttribute("transform"):"translate(0, 0)",e.state().svg_marks.push(t));break}}}if(!r)for(const n of t.childNodes)fi(n,e,[...i])}}function gi(t){let e=new ui;return fi(t,e,[0,0]),e.analyze_axes().infer_view().infer_mark_attributes(),console.log(e.state()),e}t.hydrate=function(t){"string"==typeof t&&(t=document.querySelector(t)),t&&function(t){for(const[e,n]of Object.entries(t.state().interactions)){n.control=document.querySelector("#"+e);const t=document.querySelector("#"+e+"_axis");t&&(n.axis_control=t)}return t}(gi(t)).hydrate()},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=automatic-interaction.min.js.map
